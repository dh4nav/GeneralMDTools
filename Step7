#import AtomEnsemble as ae
import os
#import sys
#import fieldtools as ft
import iotools as iot
import random
#import numpy as np

run_length = 2000000 # number of simulation frames to run before we quit

def frand(minval=0.0, maxval=1.0):
    return random.uniform(minval, maxval)

#seed random
random.seed()

#Get index
#index = int(sys.argv[1])

#Load last frame
last_frame_reader = iot.DLP2HReader(fileobj="HIk")
last_frame = last_frame_reader[-1]

timecounter = len(last_frame_reader)
if os.path.isfile("timecounter"):
    with open("timecounter") as f:
        timecounter += str(f.readline().strip())

if timecounter > run_length:
    pass # rinse and repeat with step 1
else:
    for f in last_frame_reader:
        if len(f.get_approaches("OH", "HH", 1.5, 2.0)) != 0:
            # H Bridge

            with open("timecounter", "w") as f:
                f.write("0") #reset time
            # step 8
            exit()

    with open("timecounter", "w") as f:
        f.write(str(timecounter))

    os.system("mv REVCON CONFIG; mv REVIVE REVOLD")
    #step6
